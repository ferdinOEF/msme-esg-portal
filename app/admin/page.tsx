'use client'
export const dynamic = 'force-dynamic';
import { useState } from 'react'
export default function AdminPage(){const [key,setKey]=useState('');const [status,setStatus]=useState<string|undefined>();async function addScheme(e:any){e.preventDefault();const fd=new FormData(e.target);const res=await fetch('/api/schemes',{method:'POST',headers:{'x-admin-key':key},body:JSON.stringify(Object.fromEntries(fd.entries()))});setStatus(res.ok?'Saved scheme':'Error saving scheme')}async function addLegal(e:any){e.preventDefault();const fd=new FormData(e.target);const res=await fetch('/api/legal',{method:'POST',headers:{'x-admin-key':key},body:JSON.stringify(Object.fromEntries(fd.entries()))});setStatus(res.ok?'Saved legal doc':'Error saving legal doc')}return(<div className='space-y-6'><h1 className='text-2xl font-semibold'>Admin / Update Panel</h1><div className='card'><label>Admin Key<input className='w-full border rounded p-2' value={key} onChange={e=>setKey(e.target.value)} placeholder='set ADMIN_KEY env'/></label>{status&&<div className='mt-2 text-sm'>{status}</div>}</div><div className='grid md:grid-cols-2 gap-4'><form className='card' onSubmit={addScheme}><div className='text-lg font-semibold mb-2'>Add / Update Scheme or Certification</div><input name='name' className='w-full border rounded p-2 mb-2' placeholder='Name' required/><input name='shortCode' className='w-full border rounded p-2 mb-2' placeholder='Short code (ZED, TEAM...)'/><select name='type' className='w-full border rounded p-2 mb-2'><option value='scheme'>scheme</option><option value='certification'>certification</option><option value='framework'>framework</option></select><input name='authority' className='w-full border rounded p-2 mb-2' placeholder='Authority/Owner'/><input name='pillar' className='w-full border rounded p-2 mb-2' placeholder='Comma-separated pillars E,S,G'/><textarea name='description' className='w-full border rounded p-2 mb-2' placeholder='Description'></textarea><textarea name='benefits' className='w-full border rounded p-2 mb-2' placeholder='Benefits'></textarea><textarea name='eligibility' className='w-full border rounded p-2 mb-2' placeholder='Eligibility'></textarea><input name='documentsUrl' className='w-full border rounded p-2 mb-2' placeholder='Docs URL'/><input name='tags' className='w-full border rounded p-2 mb-2' placeholder='Comma-separated tags'/><button className='btn'>Save</button></form><form className='card' onSubmit={addLegal}><div className='text-lg font-semibold mb-2'>Add Legal / Regulatory Update</div><input name='title' className='w-full border rounded p-2 mb-2' placeholder='Title' required/><input name='jurisdiction' className='w-full border rounded p-2 mb-2' placeholder='CPCB / NGT / Central / Goa'/><input name='sector' className='w-full border rounded p-2 mb-2' placeholder='Sector (optional)'/><input name='locationTag' className='w-full border rounded p-2 mb-2' placeholder='Location (e.g., Goa)'/><textarea name='summary' className='w-full border rounded p-2 mb-2' placeholder='Summary'></textarea><input name='url' className='w-full border rounded p-2 mb-2' placeholder='Link (optional)'/><input name='tags' className='w-full border rounded p-2 mb-2' placeholder='Comma-separated tags'/><button className='btn'>Save</button></form></div><div className='grid md:grid-cols-2 gap-4'><CsvBox title='Bulk Import Schemes (CSV)' endpoint='/api/import/schemes'/><CsvBox title='Bulk Import Legal Docs (CSV)' endpoint='/api/import/legal'/></div></div>)}
function CsvBox({title,endpoint}:{title:string,endpoint:string}){const [key2,setKey2]=useState('');const [csv,setCsv]=useState('');const [msg,setMsg]=useState<string|undefined>();async function send(){const res=await fetch(endpoint,{method:'POST',headers:{'x-admin-key':key2,'content-type':'text/plain'},body:csv});setMsg(res.ok?'Imported':'Error importing')}return(<div className='card'><div className='text-lg font-semibold mb-2'>{title}</div><p className='text-sm text-slate-600 mb-2'>Paste CSV text. Headers required.</p><textarea className='w-full border rounded p-2 h-40 mb-2' value={csv} onChange={e=>setCsv(e.target.value)} placeholder='name,shortCode,type,authority,pillar,tags,description,benefits,eligibility,documentsUrl&#10;ZED,ZED,scheme,MoMSME,E|S|G,msme|quality,....'></textarea><input className='w-full border rounded p-2 mb-2' value={key2} onChange={e=>setKey2(e.target.value)} placeholder='ADMIN_KEY'/><button className='btn' onClick={send}>Import</button>{msg&&<div className='mt-2 text-sm'>{msg}</div>}</div>)}
